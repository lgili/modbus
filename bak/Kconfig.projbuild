# Kconfig.projbuild - ESP-IDF menuconfig for Modbus Library
#
# This file integrates Modbus configuration into ESP-IDF's menuconfig system

menu "Modbus Configuration"

    choice MODBUS_PROFILE
        prompt "Modbus Profile"
        default MODBUS_PROFILE_LEAN
        help
            Select the Modbus feature profile:
            
            TINY  - Minimal footprint (~26KB ROM, ~8KB RAM)
            LEAN  - Balanced configuration (~40KB ROM, ~11KB RAM)
            FULL  - All features enabled (~43KB ROM, ~12KB RAM)

        config MODBUS_PROFILE_TINY
            bool "TINY - Minimal footprint"
        config MODBUS_PROFILE_LEAN
            bool "LEAN - Balanced"
        config MODBUS_PROFILE_FULL
            bool "FULL - All features"
    endchoice

    config MB_CONF_PROFILE
        int
        default 0 if MODBUS_PROFILE_TINY
        default 1 if MODBUS_PROFILE_LEAN
        default 2 if MODBUS_PROFILE_FULL

    config MB_CONF_BUILD_CLIENT
        bool "Enable Modbus Client"
        default y
        help
            Enable Modbus client (master) functionality.

    config MB_CONF_BUILD_SERVER
        bool "Enable Modbus Server"
        default y if !MODBUS_PROFILE_TINY
        default n
        help
            Enable Modbus server (slave) functionality.

    menu "Transport Layer"

        config MB_CONF_TRANSPORT_RTU
            bool "Enable RTU Transport"
            default y
            help
                Enable Modbus RTU (serial) transport.

        config MB_CONF_TRANSPORT_TCP
            bool "Enable TCP Transport"
            default y if !MODBUS_PROFILE_TINY
            default n
            help
                Enable Modbus TCP/IP transport.

        config MB_CONF_TRANSPORT_ASCII
            bool "Enable ASCII Transport"
            default n
            help
                Enable Modbus ASCII transport.

    endmenu

    menu "Function Codes"

        config MB_CONF_ENABLE_FC01
            bool "FC01 - Read Coils"
            default y if MODBUS_PROFILE_FULL
            default n

        config MB_CONF_ENABLE_FC02
            bool "FC02 - Read Discrete Inputs"
            default y if MODBUS_PROFILE_FULL
            default n

        config MB_CONF_ENABLE_FC03
            bool "FC03 - Read Holding Registers"
            default y

        config MB_CONF_ENABLE_FC04
            bool "FC04 - Read Input Registers"
            default y

        config MB_CONF_ENABLE_FC05
            bool "FC05 - Write Single Coil"
            default y if MODBUS_PROFILE_FULL
            default n

        config MB_CONF_ENABLE_FC06
            bool "FC06 - Write Single Register"
            default y

        config MB_CONF_ENABLE_FC07
            bool "FC07 - Read Exception Status"
            default y if MODBUS_PROFILE_FULL
            default n

        config MB_CONF_ENABLE_FC0F
            bool "FC15 (0x0F) - Write Multiple Coils"
            default y if MODBUS_PROFILE_FULL
            default n

        config MB_CONF_ENABLE_FC10
            bool "FC16 (0x10) - Write Multiple Registers"
            default y

        config MB_CONF_ENABLE_FC11
            bool "FC17 (0x11) - Report Server ID"
            default y if MODBUS_PROFILE_FULL
            default n

        config MB_CONF_ENABLE_FC16
            bool "FC22 (0x16) - Mask Write Register"
            default y if MODBUS_PROFILE_FULL
            default n

        config MB_CONF_ENABLE_FC17
            bool "FC23 (0x17) - Read/Write Multiple Registers"
            default y

    endmenu

    menu "Queue and Pool Settings"

        config MB_CONF_QUEUE_DEPTH
            int "Transaction Queue Depth"
            range 4 64
            default 8 if MODBUS_PROFILE_TINY
            default 16 if MODBUS_PROFILE_LEAN
            default 32 if MODBUS_PROFILE_FULL
            help
                Maximum number of pending transactions.

        config MB_CONF_MAX_PDU_SIZE
            int "Maximum PDU Size (bytes)"
            range 253 260
            default 253

        config MB_CONF_TX_POOL_SIZE
            int "TX Transaction Pool Size"
            range 4 64
            default 8 if MODBUS_PROFILE_TINY
            default 16 if MODBUS_PROFILE_LEAN
            default 32 if MODBUS_PROFILE_FULL

    endmenu

    menu "Timeouts and Timing"

        config MB_CONF_DEFAULT_TIMEOUT_MS
            int "Default Transaction Timeout (ms)"
            range 100 10000
            default 1000

        config MB_CONF_INTER_FRAME_DELAY_MS
            int "Inter-frame Delay (ms)"
            range 0 1000
            default 10

        config MB_CONF_RTU_T15_MULTIPLIER
            int "RTU T1.5 Multiplier (tenths)"
            range 10 30
            default 15
            depends on MB_CONF_TRANSPORT_RTU

        config MB_CONF_RTU_T35_MULTIPLIER
            int "RTU T3.5 Multiplier (tenths)"
            range 30 50
            default 35
            depends on MB_CONF_TRANSPORT_RTU

    endmenu

    menu "Diagnostics and Logging"

        config MB_CONF_DIAG_ENABLE_COUNTERS
            bool "Enable Diagnostic Counters"
            default y if MODBUS_PROFILE_FULL
            default n

        config MB_CONF_DIAG_ENABLE_TRACE
            bool "Enable Event Trace Buffer"
            default y if MODBUS_PROFILE_FULL
            default n

        config MB_CONF_DIAG_TRACE_DEPTH
            int "Trace Buffer Depth"
            range 16 256
            default 64
            depends on MB_CONF_DIAG_ENABLE_TRACE

        choice MB_LOG_LEVEL
            prompt "Logging Level"
            default MB_LOG_LEVEL_NONE if MODBUS_PROFILE_TINY
            default MB_LOG_LEVEL_WARN if MODBUS_PROFILE_LEAN
            default MB_LOG_LEVEL_INFO if MODBUS_PROFILE_FULL

            config MB_LOG_LEVEL_NONE
                bool "None"
            config MB_LOG_LEVEL_ERROR
                bool "Error"
            config MB_LOG_LEVEL_WARN
                bool "Warning"
            config MB_LOG_LEVEL_INFO
                bool "Info"
            config MB_LOG_LEVEL_DEBUG
                bool "Debug"
        endchoice

        config MB_CONF_LOG_LEVEL
            int
            default 0 if MB_LOG_LEVEL_NONE
            default 1 if MB_LOG_LEVEL_ERROR
            default 2 if MB_LOG_LEVEL_WARN
            default 3 if MB_LOG_LEVEL_INFO
            default 4 if MB_LOG_LEVEL_DEBUG

    endmenu

    menu "Advanced Features"

        config MB_CONF_ENABLE_POWER_MANAGEMENT
            bool "Enable Power Management"
            default n

        config MB_CONF_PORT_MUTEX
            bool "Enable Mutex Support"
            default y

        config MB_CONF_ENABLE_ISR_SAFE_MODE
            bool "Enable ISR-Safe Mode"
            default n

        config MB_CONF_ENABLE_ZERO_COPY
            bool "Enable Zero-Copy IO"
            default y if !MODBUS_PROFILE_TINY
            default n

    endmenu

endmenu
